#!/bin/sh

STAGED=$(git diff --cached --name-only --diff-filter=ACM)
if [ "$STAGED" != "" ]
then
    PHPCS=$(which phpcs 2>/dev/null)
    if [ "$PHPCS" == "" ]
    then
        PHPCS=./vendor/bin/phpcs
    fi
    if [ ! -x $PHPCS ]
    then
        echo "phpcs is not installed ..."
        exit 1
    fi
    $PHPCS -e | grep -q DrupalPractice
    if [ $? -ne 0 ]
    then
        echo "The Drupal coding standards are not installed ..."
        exit 1
    fi
    echo "Checking compliance with Drupal coding standards ..."
    $PHPCS $STAGED
    if [ $? != 0 ]
    then
        echo "Fix the problems reported and try again ..."
        exit 1
    fi
fi
exit 0
